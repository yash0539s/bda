from mrjob.job import MRJob
from datetime import datetime

class LogAnalysis(MRJob):

    def mapper(self, _, line):
        user, timestamp, action = line.strip().split()
        yield user, (timestamp, action)

    def reducer(self, user, events):
        total = 0
        login_time = None
        for ts, act in sorted(events):
            try:
                t = datetime.fromisoformat(ts)
            except:
                continue
            if act == "login":
                login_time = t
            elif act == "logout" and login_time:
                total += (t - login_time).total_seconds()
                login_time = None
        yield user, round(total / 3600, 2)

if __name__ == "__main__":
    LogAnalysis.run()
